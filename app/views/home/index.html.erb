<script type="text/javascript">
  ShopifyApp.ready(function(){
    ShopifyApp.Bar.initialize({
      title: "Home",
      icon: "<%= asset_path('favicon.ico') %>"
    });
  });
</script>

<div class="container-fluid">
  <div class="row">
    <div class='col-md-12'>
      <div class='buttons'>
      <%= link_to pull_amazon_products_path,
        class: 'btn btn-success btn-sm pull-products-btn',
        title: 'Pull products list form your amazon seller account.',
        disabled: pulling_amazon_products?,
        remote: true,
        method: :put do %>
          <% if pulling_amazon_products? %>
            Pulling products
          <% else %>
            Pull products
          <% end %>
        <% end %>
        <button type='button' id='push-selected' class='btn btn-primary btn-sm' title='Push selected products to shopify'>Push Selected</button>
        <%= link_to 'Push All', push_amazon_products_path(all: true), title: 'Push all products to shopify', class: 'btn btn-primary btn-sm', remote: true, method: :post %>
      </div>
    </div>
    
    <div class="col-md-12">
      <%= form_tag search_amazon_products_path, class: 'form-inline', method: :get, remote: true do %>
        <div class="pull-left">
          <%= select_tag :product_displayed, options_for_select(product_displayed, params[:product_displayed]), prompt: "Please select", class: 'form-control', onchange: 'product_displayed()' %>
        </div>
        <div class="pull-right">
          <div class="input-group">
            <%= text_field_tag :query, params[:query], class: 'form-control input-md', placeholder: 'Search' %>
            <div class="input-group-btn">
              <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  <div class="row">
    <!-- Need to escape in rendered js -->
    <div class="col-md-12">
      Total Products: <%= products.total_count %>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <%= form_tag push_amazon_products_path, method: 'POST', remote: true, id: 'products_form' do %>
        <table class='table table-striped table-hover table-bordered table-condensed'>
          <thead>
            <th>
              <%= check_box_tag 'push_all', true, false %>
              <label for='push_all'></label>
            </th>
            <th>Title</th>
            <th>Price</th>
            <th>Seller SKU</th>
            <th># variants</th>
          </thead>
          <tbody class="product-index">
            <%= render products %>
          </tbody>
        </table>
        <div class='pagination-wrapper'>
          <div class="row">
            <div class="col-md-12 pagination-col">
              <%= paginate products, theme: 'twitter-bootstrap-3', pagination_class: 'pagination' %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
